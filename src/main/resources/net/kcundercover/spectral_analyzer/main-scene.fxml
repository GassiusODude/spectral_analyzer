<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.canvas.Canvas?>
<?import javafx.collections.FXCollections?>
<?import java.lang.String?>

<?import javafx.scene.control.Button?>
<?import javafx.scene.control.CheckBox?>
<?import javafx.scene.control.ColorPicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Pane?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>

<?import javafx.scene.control.*?>
<VBox prefHeight="400" prefWidth="600"
      minHeight="400" minWidth="600"
      xmlns="http://javafx.com"
      xmlns:fx="http://javafx.com"
      fx:controller="net.kcundercover.spectral_analyzer.MainController">
   <children>
      <MenuBar VBox.vgrow="NEVER" style="-fx-background-color: #f4f4f4; -fx-base: #f4f4f4;">
        <menus>
          <Menu text="File">
            <items>
              <MenuItem text="Open Signal..." onAction="#handleOpen" />
              <MenuItem text="Save Signal..." onAction="#handleSave" />
              <SeparatorMenuItem />
              <MenuItem text="Exit" onAction="#handleExit" />
            </items>
          </Menu>
           <Menu text="Capabilities">
            <items>
              <MenuItem text="Connect to REST Server..." onAction="#handleConnect" />
            </items>
          </Menu>
          <Menu text="Preferences">
            <items>
              <CustomMenuItem hideOnClick="false">
                <content>
                    <VBox alignment="CENTER_LEFT" spacing="5">
                      <Separator prefWidth="200" />
                      <Label text="ANNOTATION SETTINGS"
                            style="-fx-font-weight: bold; -fx-text-fill: #888888; -fx-padding: 0 0 0 5;" />
                    </VBox>
                  </content>
              </CustomMenuItem>

              <CheckMenuItem fx:id="menuItemShowAnnotations" text="Show Annotations" selected="true" />
              <MenuItem text="Custom Annotation Dialog" onAction="#handleOpenColorDialog" />
              <MenuItem text="Default Annotation Color">
                  <graphic>
                      <ColorPicker fx:id="annotationColorPicker" onAction="#updateAnnotationDisplay" style="-fx-color-label-visible: false;" />

                  </graphic>
              </MenuItem>
              <MenuItem text="Select Color:">
                  <graphic>
                      <ColorPicker fx:id="selectColorPicker" onAction="#updateDisplay" style="-fx-color-label-visible: false;" />
                  </graphic>
              </MenuItem>
              <CustomMenuItem hideOnClick="false">
                <content>
                    <VBox alignment="CENTER_LEFT" spacing="5">
                      <Separator prefWidth="200" />
                      <Label text="SPECTROGRAM SETTINGS"
                            style="-fx-font-weight: bold; -fx-text-fill: #888888; -fx-padding: 0 0 0 5;" />
                    </VBox>
                  </content>
              </CustomMenuItem>
              <CustomMenuItem hideOnClick="false">
                  <content>
                      <ComboBox fx:id="comboColorMap" prefWidth="150.0" promptText="Select Item">
                          <items>
                              <FXCollections fx:factory="observableArrayList">
                                  <String fx:value="Grayscale" />
                                  <String fx:value="Heatmap" />
                              </FXCollections>
                          </items>
                      </ComboBox>
                  </content>
              </CustomMenuItem>

              <CheckMenuItem fx:id="fastDownConverter"
                            text="Use Fast Resample" />
            </items>
          </Menu>

          <Menu text="Help">
            <items>
              <MenuItem text="About" onAction="#handleAbout" />
              <MenuItem text="Third Party Licenses" onAction="#handleShowCredits" />
            </items>
          </Menu>
        </menus>
      </MenuBar>
      <BorderPane VBox.vgrow="ALWAYS" minHeight="0" minWidth="0">
          <!-- Frequency Axis -->
          <left>
              <Pane fx:id="frequencyRuler" prefWidth="80" style="-fx-background-color: #1a1a1a;" />
          </left>

          <!-- Spectrogam and Overlay-->
          <center>
            <StackPane fx:id="plotContainer" minWidth="0" minHeight="0" style="-fx-background-color: lightgray;">
              <children>
                  <Canvas fx:id="spectrogramCanvas" managed="true" StackPane.alignment="TOP_LEFT" />
                  <Pane fx:id="annotationOverlay" pickOnBounds="false" />
              </children>
            </StackPane>
          </center>
          <right>
            <VBox fx:id="rightPanel" spacing="20" prefWidth="220" style="-fx-background-color: #2a2a2a; -fx-padding: 15;">
              <children>
                  <VBox spacing="5">
                      <Label text="NFFT (Resolution)" style="-fx-text-fill: #cccccc; -fx-font-size: 11;"/>
                      <Slider fx:id="nfftSlider" min="6" max="16" value="10"
                              majorTickUnit="1" minorTickCount="0"
                              snapToTicks="true" showTickMarks="true"/>
                      <Label fx:id="lblNfftValue" text="1024" style="-fx-text-fill: #00aaff;"/>
                  </VBox>
                  <GridPane hgap="10" vgap="10" alignment="CENTER_LEFT">
                    <columnConstraints>
                      <ColumnConstraints hgrow="NEVER" /> <!-- Labels stay small -->
                      <ColumnConstraints hgrow="ALWAYS" /> <!-- TextFields stretch to fill -->
                    </columnConstraints>
                    <!-- Row 0: Min dB -->
                    <Label text="Min dB/Hz:" style="-fx-text-fill: #ffffff"
                          GridPane.rowIndex="0" GridPane.columnIndex="0"/>

                    <TextField fx:id="minDbInput" prefWidth="60" text="-160"
                              GridPane.rowIndex="0" GridPane.columnIndex="1"/>

                    <!-- Row 1: Max dB -->
                    <Label text="Max dB/Hz:" style="-fx-text-fill: #ffffff"
                          GridPane.rowIndex="1" GridPane.columnIndex="0"/>

                    <TextField fx:id="maxDbInput" prefWidth="60" text="-30" maxWidth="Infinity"
                              GridPane.rowIndex="1" GridPane.columnIndex="1"/>

                    <!-- Row 2: Button spanning both columns -->
                    <Button text="Update Scale" onAction="#handleScaleUpdate" maxWidth="Infinity"
                            GridPane.rowIndex="2" GridPane.columnIndex="0" GridPane.columnSpan="2"/>
                  </GridPane>

                  <Separator opacity="0.3"/>

                  <!-- SECTION 2: SELECTION INFO -->
                  <VBox spacing="10">
                    <Label text="CURRENT SELECTION" style="-fx-text-fill: #00aaff; -fx-font-weight: bold; -fx-font-size: 12;"/>

                    <GridPane hgap="10" vgap="5">
                        <Label text="Label:" style="-fx-text-fill: #aaaaaa;" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                        <TextField fx:id="selectionNameField" promptText="e.g., Give me a name!"
                                  style="-fx-background-color: #333333; -fx-text-fill: white;"
                                  GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                        <Label text="Description:" style="-fx-text-fill: #aaaaaa;" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                        <TextArea fx:id="selectionDescField" promptText="e.g., Describe Me"
                                  style="-fx-control-inner-background: #333333; -fx-text-fill: white;"
                                  prefRowCount="10" wrapText="true"
                                  GridPane.columnIndex="0" GridPane.rowIndex="2" GridPane.columnSpan="2"/>

                        <Label text="Start:" style="-fx-text-fill: #aaaaaa;" GridPane.columnIndex="0" GridPane.rowIndex="3"/>
                        <Label fx:id="lblSelectionStart" text="0.00 ms" style="-fx-text-fill: white;" GridPane.columnIndex="1" GridPane.rowIndex="3"/>

                        <Label text="Dur:" style="-fx-text-fill: #aaaaaa;" GridPane.columnIndex="0" GridPane.rowIndex="4"/>
                        <Label fx:id="lblSelectionDur" text="0.00 ms" style="-fx-text-fill: white;" GridPane.columnIndex="1" GridPane.rowIndex="4"/>

                        <Label text="Freq Low:" style="-fx-text-fill: #aaaaaa;" GridPane.columnIndex="0" GridPane.rowIndex="5"/>
                        <Label fx:id="lblFreqLow" text="0.0 MHz" style="-fx-text-fill: white;" GridPane.columnIndex="1" GridPane.rowIndex="5"/>

                        <Label text="Freq High:" style="-fx-text-fill: #aaaaaa;" GridPane.columnIndex="0" GridPane.rowIndex="6"/>
                        <Label fx:id="lblFreqHigh" text="0.00 MHz" style="-fx-text-fill: white;" GridPane.columnIndex="1" GridPane.rowIndex="6"/>
                    </GridPane>
                    <Button fx:id="btnAnalyzeSelection" text="Analyze Selection" maxWidth="Infinity"
                            style="-fx-background-color: #2e0ca8; -fx-text-fill: white;"
                            onAction="#handleAnalyzeSelection"/>
                    <Button text="Add to Annotations" maxWidth="Infinity"
                            style="-fx-background-color: #4CAF50; -fx-text-fill: white;"
                            onAction="#handleAddAnnotation"/>
                  </VBox>

                  <Region VBox.vgrow="ALWAYS" />
                </children>
            </VBox>
        </right>

          <!-- Time Labels -->
          <bottom>
            <VBox prefHeight="50.0" alignment="CENTER_LEFT" style="-fx-background-color: #1a1a1a;">
                <HBox fx:id="timeAxis" prefHeight="25" alignment="CENTER_LEFT" style="-fx-background-color: #1a1a1a;">
                    <Region fx:id="leftAxisSpacer" prefWidth="80"
                      style="-fx-background-color: transparent; -fx-border-color: transparent;"/>
                    <Pane fx:id="timeLabelsContainer" HBox.hgrow="ALWAYS" />
                    <Region fx:id="rightAxisSpacer" prefWidth="220" minWidth="220"
                      style="-fx-background-color: transparent; -fx-border-color: transparent;"/>
                </HBox>
                <ScrollBar fx:id="fileScrollBar" min="0" max="100" orientation="HORIZONTAL" />
            </VBox>
          </bottom>
      </BorderPane>


   </children>
</VBox>
